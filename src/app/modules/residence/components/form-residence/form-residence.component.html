<div class="card">
  <p-toolbar>
    <div class="p-toolbar-group-right">
      <button [disabled]="saving" pButton pRipple label="ارسال جهت تایید" (click)="submit()"
        [icon]="(saving?'pi pi-spin pi-spinner':'pi pi-save')" class="p-button-success">
      </button>
    </div>
    <div class="p-toolbar-group-left">
      <button pButton pRipple icon="pi pi-arrow-left" class="p-button-secondary"
        routerLink="/panel/residence/residence">
      </button>
    </div>
  </p-toolbar>
  <div class="p-grid p-fluid p-mt-2">
    <div class="p-col-6">
      <div class="p-grid p-fluid">
        <div class="p-col-4 p-field">
          <label for="title">نام اقامتگاه</label>
          <input type="text" id="title" pInputText [(ngModel)]="residence.title">
        </div>
        <div class="p-col-4 p-field">
          <label for="">نام شهر</label>
          <p-autoComplete [suggestions]="locations" [(ngModel)]="selectedLocation"
            (completeMethod)="getLocations($event)" field="title">
          </p-autoComplete>
        </div>
        <div class="p-col-4 p-field">
          <label for="">تلفن</label>
          <input type="" [(ngModel)]="residence.phone" pInputText>
        </div>
        <div class="p-col-4 p-field">
          <label for="">ساعت ورود از</label>
          <input type="time" [(ngModel)]="residence.fromEntranceHour" pInputText>
        </div>
        <div class="p-col-4 p-field">
          <label for="">تا ساعت ورود</label>
          <input type="time" [(ngModel)]="residence.toEntranceHour" pInputText>
        </div>
        <div class="p-col-4 p-field">
          <label for="">ساعت خروج</label>
          <input type="time" [(ngModel)]="residence.leavingHour" pInputText>
        </div>
        <div class="p-col-12 p-field">
          <label for="">آدرس</label>
          <textarea pInputTextarea [(ngModel)]="residence.address" rows="1"></textarea>
        </div>
        <div class="p-col-12 p-field">
          <label for="">توضیحات</label>
          <textarea pInputTextarea [(ngModel)]="residence.description" rows="2"></textarea>
        </div>
      </div>
    </div>
    <div class="p-col-6">
      <div class="map" leaflet (leafletMapReady)="onMapReady($event)" [leafletOptions]="options"
        [leafletLayersControl]="layersControl"></div>
    </div>
    <div class="p-col-12 p-field">
      <label for="title">قوانین اقامتگاه</label>
      <p-chips [(ngModel)]="residence.rules"></p-chips>
    </div>
    <div class="p-col-12  p-field">
      <label for="">امکانات اقامتگاه</label>
      <p-autoComplete [suggestions]="facilities" [(ngModel)]="residence.facilitiesKindIds"
        (completeMethod)="getFacilities($event)" field="title" [multiple]="true">
      </p-autoComplete>
    </div>
    <div class="p-col-12">
      <p-fieldset legend="اماکن">
        <div class="p-grid p-fluid">
          <div class="p-col-6">
            <div class="p-grid p-fluid">
              <div class="p-col-4 p-field">
                <label for="">اماکن</label>
                <p-autoComplete [suggestions]="places" [(ngModel)]="place.title" (completeMethod)="getPlaces($event)"
                  field="title">
                </p-autoComplete>
              </div>
              <div class="p-col-4 p-field">
                <label for="">وسیله نقلیه</label>
                <p-dropdown [options]="vehicles" placeholder="انتخاب" [(ngModel)]="place.vehicleId"></p-dropdown>
              </div>
              <div class="p-col-4 p-field">
                <label for="">دقیقه</label>
                <p-inputNumber mode="decimal" [useGrouping]="false" [(ngModel)]="place.minute">
                </p-inputNumber>
              </div>
              <div class="p-col-10"></div>
              <div class="p-col-2">
                <button pButton label="افزودن" icon="pi pi-plus" (click)="addPlace()"></button>
              </div>
            </div>
          </div>
          <div class="p-col-6">
            <p-table [value]="residence.places">
              <ng-template pTemplate="header">
                <tr>
                  <th>اماکن</th>
                  <th>وسیله نقلیه</th>
                  <th>دقیقه</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-place>
                <tr>
                  <td>{{place.title}}</td>
                  <td>{{place.vehicleTitle}}</td>
                  <td>{{place.minute}}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-fieldset>
    </div>
    <div class="p-col-12">
      <p-fieldset>
        <ng-template pTemplate="header">
          <div class="p-d-flex p-ai-center">
            <span>قیمت</span>
            <button style="width: auto;" pButton label="افزودن" icon="pi pi-plus" class="p-mr-4"
              (click)="addPrice()"></button>
            <i class="p-mr-4" style="font-size: 0.8em;">اگر می خواهید یک روز یا بازه ی زمانی خاصی را قیمت گزاری کنید ،از
              این دکمه استفاده کنید .</i>
          </div>
        </ng-template>
        <div class="p-grid p-fluid">
          <div class="p-col-4 p-field">
            <label for="">قیمت پایه</label>
            <p-inputNumber [(ngModel)]="residence.prices.price" suffix=" تومان">
            </p-inputNumber>
          </div>
          <div class="p-col-2 p-field">
            <label for="">قیمت پنج شنبه ها</label>
            <p-inputNumber [(ngModel)]="residence.prices.thursdayPercent" suffix=" %" placeholder="%" [min]="0"
              [max]="100" mode="decimal" [minFractionDigits]="2">
            </p-inputNumber>
          </div>
          <div class="p-col-2 p-field">
            <label for="">قیمت جمعه ها</label>
            <p-inputNumber [(ngModel)]="residence.prices.fridayPercent" suffix=" %" placeholder="%" [min]="0"
              [max]="100" mode="decimal" [minFractionDigits]="2">
            </p-inputNumber>
          </div>
          <div class="p-col-2 p-field">
            <label for="">تعطیلات رسمی</label>
            <p-inputNumber [(ngModel)]="residence.prices.beforeHoliday" suffix=" %" placeholder="%" [min]="0"
              [max]="100" mode="decimal" [minFractionDigits]="2">
            </p-inputNumber>
          </div>
          <div class="p-col-2 p-field">
            <label for="">روز قبل از تعطیلات رسمی</label>
            <p-inputNumber [(ngModel)]="residence.prices.holiday" suffix=" %" placeholder="%" [min]="0" [max]="100"
              mode="decimal" [minFractionDigits]="2">
            </p-inputNumber>
          </div>
          <div class="p-col-12" *ngFor="let role of residence.prices.priceRules;let i = index">
            <div class="p-grid p-field">
              <div class="p-col-4 p-field">
                <label for="fromDate">از تاریخ</label>
                <dp-date-picker id="fromDate" [(ngModel)]="role.from" dir="ltr" theme="dp-material" mode="day">
                </dp-date-picker>
              </div>
              <div class="p-col-4 p-field">
                <label for="toDate">تا تاریخ</label>
                <dp-date-picker id="toDate" [(ngModel)]="role.to" dir="ltr" theme="dp-material" mode="day">
                </dp-date-picker>
              </div>
              <div class="p-col-3 p-field">
                <label for="">قیمت پایه</label>
                <p-inputNumber [(ngModel)]="role.price" suffix=" تومان">
                </p-inputNumber>
              </div>
              <div class="p-col-1 p-field">
                <label for="">   </label>
                <button pButton icon="pi pi-times" class="p-button-danger p-button-rounded p-button-text p-mt-5"
                  (click)="removePrice(i)"></button>
              </div>
            </div>
          </div>
        </div>
      </p-fieldset>
    </div>
    <div class="p-col-12">
      <p-fieldset legend="تصاویر">
        <div class="p-grid p-fluid">
          <div class="p-col-12 p-d-flex p-flex-wrap p-jc-center p-jc-lg-start">
            <div class="add-img p-d-flex p-ai-center p-jc-center">
              <div class="add-circle p-d-flex p-ai-center p-jc-center">
                <img src="assets/layout/images/camera.svg" (click)="file.click()">
              </div>
              <input type="file" #file accept=".jpg,.png,.jpeg" (change)="addImage($event)" style="display:none;">
            </div>
            <div class="img p-d-flex p-ai-center p-jc-center" *ngFor="let img of images;let i = index">
              <div class="main p-d-flex p-ai-center p-jc-center">
                <img [src]="img.url" (error)="defaultImg(img)" (click)="displayGallery=true" />
              </div>
              <div class="tools">
                <div class="circle p-d-flex p-ai-center p-jc-center" (click)="deleteImage(img,i)">
                  <img src="assets/layout/images/bin.svg">
                </div>
                <div class="circle p-d-flex p-ai-center p-jc-center p-mr-2">
                  <p-radioButton name="isMain" [value]="i" [(ngModel)]="mainImageIndex"></p-radioButton>
                </div>
              </div>
            </div>
          </div>
          <div class="p-col-12">
            <p>یک تصویر را به عنوان تصویر شاخص انتخاب کنید.</p>
          </div>
        </div>
      </p-fieldset>
    </div>
  </div>
</div>
